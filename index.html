<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Personal Notes</title>
<meta name="theme-color" content="#0f172a">
<link rel="manifest" href="manifest.json">
<style>
:root{--bg:#020617;--card:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--accent:#38bdf8;--danger:#ef4444}
*{box-sizing:border-box}
body{margin:0;min-height:100vh;font-family:system-ui;background:linear-gradient(135deg,#020617,#0f172a);color:var(--text);display:flex;align-items:center;justify-content:center}
.app{width:100%;max-width:720px;background:var(--card);border-radius:16px;padding:20px;box-shadow:0 20px 40px rgba(0,0,0,.5)}
h1{margin:0 0 10px 0;font-size:1.2rem}
input,textarea,select{width:100%;padding:12px;border-radius:12px;border:1px solid #1f2937;background:#020617;color:var(--text)}
textarea{min-height:120px;resize:vertical}
.actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
button{border:none;border-radius:10px;padding:10px 14px;font-size:.9rem;cursor:pointer;background:var(--accent);color:#020617;font-weight:600}
button.secondary{background:#1f2937;color:var(--text)}
button.danger{background:var(--danger);color:#fff}
ul{list-style:none;padding:0;margin:16px 0 0 0;display:grid;gap:10px}
li{background:#020617;border:1px solid #1f2937;border-radius:12px;padding:12px}
.note-meta{font-size:.75rem;color:var(--muted);display:flex;justify-content:space-between}
.hidden{display:none}
</style>
</head>
<body>
<div class="app">

<!-- STEALTH SCREEN -->
<div id="stealth">
<h1>Calculator</h1>
<input placeholder="0" disabled>
<div class="actions">
<button class="secondary" onclick="exitStealth()">=</button>
</div>
</div>

<!-- LOCK / PROFILE SCREEN -->
<div id="lock" class="hidden">
<h1>Unlock</h1>
<select id="profile"></select>
<input id="pin" type="password" inputmode="numeric" placeholder="PIN">
<div class="actions">
<button onclick="unlock()">Unlock</button>
<button class="secondary" onclick="newProfile()">New Profile</button>
</div>
</div>

<!-- APP -->
<div id="app" class="hidden">
<h1 id="profileName"></h1>
<textarea id="noteInput" placeholder="Write a note..."></textarea>
<div class="actions">
<button onclick="saveNote()">Save</button>
<button class="secondary" onclick="lockApp()">Lock</button>
<button class="danger" onclick="clearNotes()">Clear</button>
</div>
<ul id="notes"></ul>
</div>

</div>

<script>
const DB_KEY="notes_profiles";
let current=null;

function db(){return JSON.parse(localStorage.getItem(DB_KEY)||"{}");}
function saveDb(d){localStorage.setItem(DB_KEY,JSON.stringify(d));}

async function hash(v){const b=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(v));return Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,"0")).join("")}

function exitStealth(){document.getElementById("stealth").classList.add("hidden");document.getElementById("lock").classList.remove("hidden");loadProfiles()}

function loadProfiles(){const p=db();const sel=document.getElementById("profile");sel.innerHTML="";Object.keys(p).forEach(k=>{const o=document.createElement("option");o.value=k;o.textContent=k;sel.appendChild(o)})}

async function newProfile(){const name=prompt("Profile name");if(!name)return;const pin=prompt("Set PIN (4+ digits)");if(!pin||pin.length<4)return;const d=db();d[name]={pin:await hash(pin),notes:[]};saveDb(d);loadProfiles()}

async function unlock(){const sel=document.getElementById("profile").value;const pin=document.getElementById("pin").value;const d=db();if(!d[sel])return;const h=await hash(pin);if(h!==d[sel].pin)return alert("Wrong PIN");current=sel;document.getElementById("lock").classList.add("hidden");document.getElementById("app").classList.remove("hidden");document.getElementById("profileName").textContent=sel;render()}

function lockApp(){current=null;document.getElementById("app").classList.add("hidden");document.getElementById("lock").classList.remove("hidden")}

function saveNote(){const t=document.getElementById("noteInput").value.trim();if(!t)return;const d=db();d[current].notes.unshift({t,ts:new Date().toISOString()});saveDb(d);document.getElementById("noteInput").value="";render()}

function clearNotes(){if(!confirm("Clear all notes?"))return;const d=db();d[current].notes=[];saveDb(d);render()}

function render(){const ul=document.getElementById("notes");ul.innerHTML="";const d=db()[current].notes;d.forEach(n=>{const li=document.createElement("li");li.textContent=n.t;const m=document.createElement("div");m.className="note-meta";m.textContent=new Date(n.ts).toLocaleString();li.appendChild(m);ul.appendChild(li)})}

if("serviceWorker"in navigator){navigator.serviceWorker.register("sw.js")}
</script>
</body>
</html>
